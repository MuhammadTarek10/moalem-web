{
  "openapi": "3.0.0",
  "paths": {
    "/api/v1/auth/sign-up": {
      "post": {
        "description": "Creates a new user account and returns tokens in both response body and HTTP-only cookies",
        "operationId": "AuthController_signUp_v1",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SignUpDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User signed up successfully. Tokens are returned in response and set as HTTP-only cookies",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/TokenResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    }
                  ]
                }
              }
            }
          }
        },
        "summary": "Sign up a new user",
        "tags": ["Authentication"]
      }
    },
    "/api/v1/auth/sign-in": {
      "post": {
        "description": "Authenticates a user and returns tokens in both response body and HTTP-only cookies",
        "operationId": "AuthController_signIn_v1",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SignInDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User signed in successfully. Tokens are returned in response and set as HTTP-only cookies",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/TokenResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    }
                  ]
                }
              }
            }
          }
        },
        "summary": "Sign in a user",
        "tags": ["Authentication"]
      }
    },
    "/api/v1/auth/refresh": {
      "post": {
        "description": "Use Bearer token or HTTP-only cookie (refresh_token) for authentication",
        "operationId": "AuthController_refresh_v1",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/TokenResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "refresh_token": []
          },
          {
            "bearer": []
          }
        ],
        "summary": "Refresh a user's token",
        "tags": ["Authentication"]
      }
    },
    "/api/v1/auth/sign-out": {
      "post": {
        "description": "Use Bearer token or HTTP-only cookie (access_token) for authentication. Clears all authentication cookies",
        "operationId": "AuthController_signOut_v1",
        "parameters": [],
        "responses": {
          "200": {
            "description": "User signed out successfully"
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "access_token": []
          },
          {
            "bearer": []
          }
        ],
        "summary": "Sign out a user",
        "tags": ["Authentication"]
      }
    },
    "/api/v1/users/profile": {
      "get": {
        "operationId": "UsersController_getProfile_v1",
        "parameters": [],
        "responses": {
          "200": {
            "description": "User profile retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/UserResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get user profile",
        "tags": ["Users"]
      }
    },
    "/api/v1/license/create-coupon": {
      "post": {
        "operationId": "LicenseController_createCoupon_v1",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCouponDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Coupon created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/CreateCouponResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Create a new coupon (Admin only)",
        "tags": ["License"]
      }
    },
    "/api/v1/license/redeem-coupon": {
      "post": {
        "operationId": "LicenseController_redeemCoupon_v1",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RedeemCouponDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Coupon redeemed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/RedeemCouponResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Redeem a coupon code",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons": {
      "get": {
        "operationId": "LicenseController_listCoupons_v1",
        "parameters": [
          {
            "name": "status",
            "required": false,
            "in": "query",
            "description": "Filter coupons by status: valid=not redeemed/revoked, invalid=redeemed or revoked",
            "schema": {
              "default": "all",
              "type": "string",
              "enum": ["all", "valid", "invalid", "redeemed", "revoked"]
            }
          },
          {
            "name": "search",
            "required": false,
            "in": "query",
            "description": "Search by code, issuer name/email, or redeemer name/email",
            "schema": {
              "example": "mohamed",
              "type": "string"
            }
          },
          {
            "name": "createdFrom",
            "required": false,
            "in": "query",
            "description": "Filter by createdAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "createdTo",
            "required": false,
            "in": "query",
            "description": "Filter by createdAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "redeemedFrom",
            "required": false,
            "in": "query",
            "description": "Filter by redeemedAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "redeemedTo",
            "required": false,
            "in": "query",
            "description": "Filter by redeemedAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "expiresFrom",
            "required": false,
            "in": "query",
            "description": "Filter by expiresAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "expiresTo",
            "required": false,
            "in": "query",
            "description": "Filter by expiresAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "page",
            "required": false,
            "in": "query",
            "description": "Page number",
            "schema": {
              "default": 1,
              "example": 1,
              "type": "number"
            }
          },
          {
            "name": "limit",
            "required": false,
            "in": "query",
            "description": "Items per page",
            "schema": {
              "default": 20,
              "example": 20,
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Coupons fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/PaginatedAdminCouponsResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "List coupons with admin filters",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/redeemed": {
      "get": {
        "operationId": "LicenseController_listRedeemedCoupons_v1",
        "parameters": [
          {
            "name": "status",
            "required": false,
            "in": "query",
            "description": "Filter coupons by status: valid=not redeemed/revoked, invalid=redeemed or revoked",
            "schema": {
              "default": "all",
              "type": "string",
              "enum": ["all", "valid", "invalid", "redeemed", "revoked"]
            }
          },
          {
            "name": "search",
            "required": false,
            "in": "query",
            "description": "Search by code, issuer name/email, or redeemer name/email",
            "schema": {
              "example": "mohamed",
              "type": "string"
            }
          },
          {
            "name": "createdFrom",
            "required": false,
            "in": "query",
            "description": "Filter by createdAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "createdTo",
            "required": false,
            "in": "query",
            "description": "Filter by createdAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "redeemedFrom",
            "required": false,
            "in": "query",
            "description": "Filter by redeemedAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "redeemedTo",
            "required": false,
            "in": "query",
            "description": "Filter by redeemedAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "expiresFrom",
            "required": false,
            "in": "query",
            "description": "Filter by expiresAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "expiresTo",
            "required": false,
            "in": "query",
            "description": "Filter by expiresAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "page",
            "required": false,
            "in": "query",
            "description": "Page number",
            "schema": {
              "default": 1,
              "example": 1,
              "type": "number"
            }
          },
          {
            "name": "limit",
            "required": false,
            "in": "query",
            "description": "Items per page",
            "schema": {
              "default": 20,
              "example": 20,
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Redeemed coupons fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/PaginatedAdminCouponsResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "List redeemed coupons with redeemer info",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/stats": {
      "get": {
        "operationId": "LicenseController_getCouponStats_v1",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Coupon stats fetched successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/CouponsStatsResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get coupon stats for admin dashboard",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/export/csv": {
      "get": {
        "operationId": "LicenseController_exportCouponsCsv_v1",
        "parameters": [
          {
            "name": "status",
            "required": false,
            "in": "query",
            "description": "Filter coupons by status: valid=not redeemed/revoked, invalid=redeemed or revoked",
            "schema": {
              "default": "all",
              "type": "string",
              "enum": ["all", "valid", "invalid", "redeemed", "revoked"]
            }
          },
          {
            "name": "search",
            "required": false,
            "in": "query",
            "description": "Search by code, issuer name/email, or redeemer name/email",
            "schema": {
              "example": "mohamed",
              "type": "string"
            }
          },
          {
            "name": "createdFrom",
            "required": false,
            "in": "query",
            "description": "Filter by createdAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "createdTo",
            "required": false,
            "in": "query",
            "description": "Filter by createdAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "redeemedFrom",
            "required": false,
            "in": "query",
            "description": "Filter by redeemedAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "redeemedTo",
            "required": false,
            "in": "query",
            "description": "Filter by redeemedAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "expiresFrom",
            "required": false,
            "in": "query",
            "description": "Filter by expiresAt from date (ISO string)",
            "schema": {
              "example": "2026-01-01T00:00:00.000Z",
              "type": "string"
            }
          },
          {
            "name": "expiresTo",
            "required": false,
            "in": "query",
            "description": "Filter by expiresAt to date (ISO string)",
            "schema": {
              "example": "2026-01-31T23:59:59.999Z",
              "type": "string"
            }
          },
          {
            "name": "page",
            "required": false,
            "in": "query",
            "description": "Page number",
            "schema": {
              "default": 1,
              "example": 1,
              "type": "number"
            }
          },
          {
            "name": "limit",
            "required": false,
            "in": "query",
            "description": "Items per page",
            "schema": {
              "default": 20,
              "example": 20,
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Coupons CSV exported successfully",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Export coupons list as CSV",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/stats/export/csv": {
      "get": {
        "operationId": "LicenseController_exportCouponStatsCsv_v1",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Coupon stats CSV exported successfully",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Export coupon stats as CSV",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/{couponId}/revoke": {
      "patch": {
        "operationId": "LicenseController_revokeCoupon_v1",
        "parameters": [
          {
            "name": "couponId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RevokeCouponDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Coupon revoked successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/CouponResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Revoke an unused coupon",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/{couponId}/reissue": {
      "post": {
        "operationId": "LicenseController_reissueCoupon_v1",
        "parameters": [
          {
            "name": "couponId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReissueCouponDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Coupon reissued successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/ReissueCouponResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Reissue an unused second coupon with a new code",
        "tags": ["License"]
      }
    },
    "/api/v1/license/admin/coupons/{couponId}": {
      "delete": {
        "operationId": "LicenseController_deleteCoupon_v1",
        "parameters": [
          {
            "name": "couponId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Coupon deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/ResponseDto"
                    },
                    {
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/DeleteCouponResponseDto"
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Delete an unused coupon",
        "tags": ["License"]
      }
    }
  },
  "info": {
    "title": "Auth API",
    "description": "Auth API with dual authentication support: Bearer tokens and HTTP-only cookies",
    "version": "1.0",
    "contact": {}
  },
  "tags": [],
  "servers": [],
  "components": {
    "securitySchemes": {
      "bearer": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http",
        "description": "JWT Bearer token for access. Alternatively, use HTTP-only cookies."
      },
      "cookie": {
        "type": "apiKey",
        "in": "cookie",
        "name": "refresh_token",
        "description": "HTTP-only cookie containing the refresh token"
      }
    },
    "schemas": {
      "ResponseDto": {
        "type": "object",
        "properties": {
          "data": {
            "type": "object",
            "description": "The data of the response"
          },
          "message": {
            "type": "string",
            "description": "The message of the response",
            "example": "User retrieved successfully"
          },
          "error": {
            "type": "string",
            "description": "The error of the response",
            "example": "User not found"
          },
          "status": {
            "type": "string",
            "description": "The status of the response",
            "example": "success",
            "enum": ["success", "error"]
          }
        },
        "required": ["data", "message", "error", "status"]
      },
      "TokenResponseDto": {
        "type": "object",
        "properties": {
          "access_token": {
            "type": "string",
            "description": "The access token. Also available as an HTTP-only cookie named \"access_token\"",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
          },
          "refresh_token": {
            "type": "string",
            "description": "The refresh token. Also available as an HTTP-only cookie named \"refresh_token\"",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
          },
          "expires_in": {
            "type": "number",
            "description": "Access token expiration time in seconds",
            "example": 3600
          }
        },
        "required": ["access_token", "refresh_token", "expires_in"]
      },
      "SignUpDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "The name of the user",
            "example": "John Doe"
          },
          "email": {
            "type": "string",
            "description": "The email of the user",
            "example": "test@example.com"
          },
          "password": {
            "type": "string",
            "description": "The password of the user",
            "example": "Test@123"
          },
          "whatsapp_number": {
            "type": "string",
            "description": "The WhatsApp number of the user",
            "example": "+201234567890"
          },
          "governorate": {
            "type": "string",
            "description": "The governorate of the user",
            "example": "Cairo"
          },
          "education_administration": {
            "type": "string",
            "description": "The education administration of the user",
            "example": "Nasr City"
          },
          "subjects": {
            "description": "The subjects the user is interested in",
            "example": ["Math", "Science"],
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "schools": {
            "description": "The schools associated with the user",
            "example": ["School A", "School B"],
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "grades": {
            "description": "The grades the user teaches or is in",
            "example": ["Grade 10", "Grade 11"],
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["name", "email", "password", "whatsapp_number"]
      },
      "SignInDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "The email of the user",
            "example": "test@example.com"
          },
          "password": {
            "type": "string",
            "description": "The password of the user",
            "example": "Test@123"
          }
        },
        "required": ["email", "password"]
      },
      "UserResponseDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "The id of the user",
            "example": "1234567890"
          },
          "name": {
            "type": "string",
            "description": "The name of the user",
            "example": "John Doe"
          },
          "email": {
            "type": "string",
            "description": "The email of the user",
            "example": "john.doe@example.com"
          },
          "sessionId": {
            "type": "string",
            "description": "The session id of the user",
            "example": "1234567890"
          },
          "deletedAt": {
            "format": "date-time",
            "type": "string",
            "description": "The date and time the user was deleted",
            "example": "2021-01-01T00:00:00.000Z"
          }
        },
        "required": ["_id", "name", "email", "sessionId", "deletedAt"]
      },
      "CouponResponseDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "The unique identifier of the coupon",
            "example": "507f1f77bcf86cd799439011"
          },
          "code": {
            "type": "string",
            "description": "The coupon code",
            "example": "SUMMER2024"
          },
          "issuedBy": {
            "type": "string",
            "description": "The ID of the user who issued the coupon",
            "example": "507f1f77bcf86cd799439012"
          },
          "duration": {
            "type": "number",
            "description": "The duration of the license in days",
            "example": 30
          },
          "isRedeemed": {
            "type": "boolean",
            "description": "Whether the coupon has been redeemed",
            "example": false
          },
          "expiresAt": {
            "format": "date-time",
            "type": "string",
            "description": "The expiration date of the license granted by this coupon (set on redeem)",
            "example": "2024-12-31T23:59:59.999Z"
          },
          "createdAt": {
            "format": "date-time",
            "type": "string",
            "description": "The creation date of the coupon",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "updatedAt": {
            "format": "date-time",
            "type": "string",
            "description": "The last update date of the coupon",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "isFirstCode": {
            "type": "boolean",
            "description": "Whether this is the first code in the chain",
            "example": true
          },
          "firstCouponId": {
            "type": "string",
            "description": "The ID of the first coupon in the chain",
            "example": "507f1f77bcf86cd799439011"
          },
          "redeemedBy": {
            "type": "string",
            "description": "The ID of the user who redeemed the coupon",
            "example": "507f1f77bcf86cd799439012"
          },
          "redeemedAt": {
            "format": "date-time",
            "type": "string",
            "description": "The date when the coupon was redeemed",
            "example": "2024-01-01T00:00:00.000Z"
          }
        },
        "required": [
          "_id",
          "code",
          "issuedBy",
          "duration",
          "isRedeemed",
          "createdAt",
          "updatedAt",
          "isFirstCode"
        ]
      },
      "CreateCouponResponseDto": {
        "type": "object",
        "properties": {
          "firstCoupon": {
            "$ref": "#/components/schemas/CouponResponseDto"
          },
          "secondCoupon": {
            "$ref": "#/components/schemas/CouponResponseDto"
          }
        },
        "required": ["firstCoupon", "secondCoupon"]
      },
      "RedeemCouponResponseDto": {
        "type": "object",
        "properties": {
          "license": {
            "type": "string",
            "description": "The license token",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
          },
          "expiresAt": {
            "format": "date-time",
            "type": "string",
            "description": "The expiration date of the license",
            "example": "2026-02-25T04:39:18.240Z"
          },
          "message": {
            "type": "string",
            "description": "Message indicating the result of the operation",
            "example": "First code accepted"
          }
        }
      },
      "CouponAdminUserDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "example": "507f1f77bcf86cd799439012"
          },
          "name": {
            "type": "string",
            "example": "Admin User"
          },
          "email": {
            "type": "string",
            "example": "admin@example.com"
          }
        }
      },
      "CouponAdminItemDto": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "example": "507f1f77bcf86cd799439011"
          },
          "code": {
            "type": "string",
            "example": "SUMMER2024"
          },
          "duration": {
            "type": "number",
            "example": 30
          },
          "isRedeemed": {
            "type": "boolean",
            "example": false
          },
          "isRevoked": {
            "type": "boolean",
            "example": false
          },
          "isFirstCode": {
            "type": "boolean",
            "example": false
          },
          "firstCouponId": {
            "type": "string",
            "example": "507f1f77bcf86cd799439099"
          },
          "redeemedAt": {
            "format": "date-time",
            "type": "string",
            "example": "2026-02-16T00:00:00.000Z"
          },
          "expiresAt": {
            "format": "date-time",
            "type": "string",
            "example": "2026-03-16T00:00:00.000Z"
          },
          "revokedAt": {
            "format": "date-time",
            "type": "string",
            "example": "2026-02-20T00:00:00.000Z"
          },
          "revokeReason": {
            "type": "string",
            "example": "Coupon leaked publicly"
          },
          "issuedBy": {
            "$ref": "#/components/schemas/CouponAdminUserDto"
          },
          "redeemedBy": {
            "$ref": "#/components/schemas/CouponAdminUserDto"
          },
          "revokedBy": {
            "$ref": "#/components/schemas/CouponAdminUserDto"
          }
        },
        "required": [
          "_id",
          "code",
          "duration",
          "isRedeemed",
          "isRevoked",
          "isFirstCode"
        ]
      },
      "PaginatedAdminCouponsResponseDto": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CouponAdminItemDto"
            }
          },
          "total": {
            "type": "number",
            "example": 120
          },
          "page": {
            "type": "number",
            "example": 1
          },
          "limit": {
            "type": "number",
            "example": 20
          },
          "totalPages": {
            "type": "number",
            "example": 6
          }
        },
        "required": ["items", "total", "page", "limit", "totalPages"]
      },
      "CouponsStatsResponseDto": {
        "type": "object",
        "properties": {
          "totalCoupons": {
            "type": "number",
            "example": 400
          },
          "validCoupons": {
            "type": "number",
            "example": 250
          },
          "invalidCoupons": {
            "type": "number",
            "example": 150
          },
          "redeemedCoupons": {
            "type": "number",
            "example": 130
          },
          "revokedCoupons": {
            "type": "number",
            "example": 20
          },
          "availableCoupons": {
            "type": "number",
            "example": 250
          },
          "activeLicenses": {
            "type": "number",
            "example": 90
          },
          "expiredLicenses": {
            "type": "number",
            "example": 40
          }
        },
        "required": [
          "totalCoupons",
          "validCoupons",
          "invalidCoupons",
          "redeemedCoupons",
          "revokedCoupons",
          "availableCoupons",
          "activeLicenses",
          "expiredLicenses"
        ]
      },
      "ReissueCouponResponseDto": {
        "type": "object",
        "properties": {
          "oldCoupon": {
            "$ref": "#/components/schemas/CouponResponseDto"
          },
          "newCoupon": {
            "$ref": "#/components/schemas/CouponResponseDto"
          }
        }
      },
      "DeleteCouponResponseDto": {
        "type": "object",
        "properties": {
          "deleted": {
            "type": "boolean",
            "example": true
          }
        },
        "required": ["deleted"]
      },
      "CreateCouponDto": {
        "type": "object",
        "properties": {
          "duration": {
            "type": "number",
            "description": "The duration of the coupon in days",
            "example": 30,
            "default": 30
          }
        }
      },
      "RedeemCouponDto": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "The code of the coupon",
            "example": "1234567890"
          }
        },
        "required": ["code"]
      },
      "RevokeCouponDto": {
        "type": "object",
        "properties": {
          "reason": {
            "type": "string",
            "description": "Reason for revoking the coupon",
            "example": "Coupon leaked publicly"
          }
        }
      },
      "ReissueCouponDto": {
        "type": "object",
        "properties": {
          "reason": {
            "type": "string",
            "description": "Reason for reissuing the coupon",
            "example": "User lost original code"
          }
        }
      }
    }
  }
}
